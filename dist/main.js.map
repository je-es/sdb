{"version":3,"sources":["../src/main.ts"],"names":["DB","path","Database","schema","sql","index","indexSql","tableName","table","conditions","whereConditions","column","value","id","data","lastId","callback","error","params","builder","self","columns","condition","whereClauses","cond","placeholders","val","direction","count","setClauses","col","updateValues","result","results","columnDefs","def","name","type","integer","text","real","blob","numeric","primaryKey","autoIncrement","notNull","unique","defaultValue","references"],"mappings":"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","file":"main.js","sourcesContent":["// src/main.ts\n//\n// Developed with ❤️ by Maysara.\n\n\n\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\n\n    import { Database } from 'bun:sqlite';\n    import * as types from './types.d';\n    export * from './types.d';\n\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\n\n\n\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\n\n    export class DB {\n\n        // ┌──────────────────────────────── INIT ──────────────────────────────┐\n\n            private db              : Database;\n            private schemas         : Map<string, types.TableSchema>;\n            private currentQuery    : string = '';\n            private currentParams   : types.SqlValue[] = [];\n\n        // └────────────────────────────────────────────────────────────────────┘\n\n\n        // ┌──────────────────────────────── CORE ──────────────────────────────┐\n\n            constructor(path: string = ':memory:') {\n                this.schemas = new Map;\n                this.db = new Database(path);\n                this.db.exec('PRAGMA foreign_keys = ON');\n            }\n\n            close(): void {\n                this.db.close();\n            }\n\n            // ════════ Schema Management ════════\n            defineSchema(schema: types.TableSchema): void {\n                this.schemas.set(schema.name, schema);\n                const sql = this.generateCreateTableSQL(schema);\n                this.db.exec(sql);\n\n                // Create indexes\n                if (schema.indexes) {\n                    for (const index of schema.indexes) {\n                        const uniqueStr = index.unique ? 'UNIQUE' : '';\n                        const indexSql = `CREATE ${uniqueStr} INDEX IF NOT EXISTS ${index.name} ON ${schema.name} (${index.columns.join(', ')})`;\n                        this.db.exec(indexSql);\n                    }\n                }\n            }\n\n            getSchema(tableName: string): types.TableSchema | undefined {\n                return this.schemas.get(tableName);\n            }\n\n            listTables(): string[] {\n                const result = this.db.query(\"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'\").all();\n                return result.map((r: unknown) => (r as types.TableRow).name);\n            }\n\n            dropTable(tableName: string): void {\n                this.db.exec(`DROP TABLE IF EXISTS ${tableName}`);\n                this.schemas.delete(tableName);\n            }\n\n            // ════════ Query Builder ════════\n            query(): types.QueryBuilder {\n                this.reset();\n                return this.createQueryBuilder();\n            }\n\n            // ════════ Quick Operations ════════\n            find(table: string, conditions: Record<string, types.SqlValue>): unknown[] {\n                const whereConditions: types.WhereCondition[] = Object.entries(conditions).map(([column, value]) => ({\n                    column,\n                    operator: '=' as const,\n                    value\n                }));\n\n                return this.query()\n                    .select()\n                    .from(table)\n                    .where(whereConditions)\n                    .execute();\n            }\n\n            findOne(table: string, conditions: Record<string, types.SqlValue>): unknown | null {\n                return this.query()\n                    .select()\n                    .from(table)\n                    .where(Object.entries(conditions).map(([column, value]) => ({\n                        column,\n                        operator: '=' as const,\n                        value\n                    })))\n                    .limit(1)\n                    .executeOne();\n            }\n\n            findById(table: string, id: number | string): unknown | null {\n                return this.findOne(table, { id });\n            }\n\n            all(table: string): unknown[] {\n                return this.query().select().from(table).execute();\n            }\n\n            insert(table: string, data: Record<string, types.SqlValue>): unknown {\n                this.query().insert(table, data).execute();\n\n                // Return inserted row\n                const lastId = this.db.query('SELECT last_insert_rowid() as id').get() as types.LastIdRow;\n                return this.findById(table, lastId.id);\n            }\n\n            update(table: string, id: number | string, data: Record<string, types.SqlValue>): unknown | null {\n                this.query()\n                    .update(table, data)\n                    .where({ column: 'id', operator: '=', value: id })\n                    .execute();\n\n                return this.findById(table, id);\n            }\n\n            delete(table: string, id: number | string): boolean {\n                this.query()\n                    .delete(table)\n                    .where({ column: 'id', operator: '=', value: id })\n                    .execute();\n\n                return true;\n            }\n\n            // ════════ Transactions ════════\n            transaction(callback: (db: DB) => void): void {\n                this.db.exec('BEGIN TRANSACTION');\n                try {\n                    callback(this);\n                    this.db.exec('COMMIT');\n                } catch (error) {\n                    this.db.exec('ROLLBACK');\n                    throw error;\n                }\n            }\n\n            // ════════ Raw SQL ════════\n            exec(sql: string): void {\n                this.db.exec(sql);\n            }\n\n            raw(sql: string, params: types.SqlValue[] = []): unknown[] {\n                const stmt = this.db.query(sql);\n                return stmt.all(...params) as unknown[];\n            }\n\n            rawOne(sql: string, params: types.SqlValue[] = []): unknown | null {\n                const stmt = this.db.query(sql);\n                return stmt.get(...params) as unknown | null;\n            }\n\n        // └────────────────────────────────────────────────────────────────────┘\n\n\n        // ┌──────────────────────────────── HELP ──────────────────────────────┐\n\n            private reset(): void {\n                this.currentQuery = '';\n                this.currentParams = [];\n            }\n\n            private createQueryBuilder(): types.QueryBuilder {\n                const builder: types.QueryBuilderInternal & Partial<types.QueryBuilder> = {\n                    _select: ['*'],\n                    _from: '',\n                    _where: [],\n                    _orderBy: '',\n                    _limit: null,\n                    _offset: null,\n                    _isInsert: false,\n                    _isUpdate: false,\n                    _isDelete: false,\n                    _insertData: null,\n                    _updateData: null\n                };\n\n                // Bind methods to this DB instance\n                // eslint-disable-next-line @typescript-eslint/no-this-alias\n                const self = this;\n\n                builder.select = function(columns?: string[]): types.QueryBuilder {\n                    this._select = columns || ['*'];\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.from = function(table: string): types.QueryBuilder {\n                    this._from = table;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.where = function(condition: types.WhereCondition | types.WhereCondition[]): types.QueryBuilder {\n                    const conditions = Array.isArray(condition) ? condition : [condition];\n\n                    const whereClauses = conditions.map(cond => {\n                        if (cond.operator === 'IS NULL' || cond.operator === 'IS NOT NULL') {\n                            return `${cond.column} ${cond.operator}`;\n                        } else if (cond.operator === 'IN' && Array.isArray(cond.value)) {\n                            const placeholders = cond.value.map(() => '?').join(', ');\n                            // Spread array values into params\n                            cond.value.forEach(val => {\n                                self.currentParams.push(val as types.SqlValue);\n                            });\n                            return `${cond.column} IN (${placeholders})`;\n                        } else {\n                            self.currentParams.push(cond.value as types.SqlValue);\n                            return `${cond.column} ${cond.operator} ?`;\n                        }\n                    });\n\n                    this._where.push(...whereClauses);\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.and = function(condition: types.WhereCondition): types.QueryBuilder {\n                    return this.where!(condition);\n                };\n\n                builder.or = function(condition: types.WhereCondition): types.QueryBuilder {\n                    if (condition.operator === 'IS NULL' || condition.operator === 'IS NOT NULL') {\n                        this._where.push(`OR ${condition.column} ${condition.operator}`);\n                    } else if (condition.operator === 'IN' && Array.isArray(condition.value)) {\n                        const placeholders = condition.value.map(() => '?').join(', ');\n                        // Spread array values into params\n                        condition.value.forEach(val => {\n                            self.currentParams.push(val as types.SqlValue);\n                        });\n                        this._where.push(`OR ${condition.column} IN (${placeholders})`);\n                    } else {\n                        self.currentParams.push(condition.value as types.SqlValue);\n                        this._where.push(`OR ${condition.column} ${condition.operator} ?`);\n                    }\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.orderBy = function(column: string, direction: 'ASC' | 'DESC' = 'ASC'): types.QueryBuilder {\n                    this._orderBy = `ORDER BY ${column} ${direction}`;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.limit = function(count: number): types.QueryBuilder {\n                    this._limit = count;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.offset = function(count: number): types.QueryBuilder {\n                    this._offset = count;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.insert = function(table: string, data: Record<string, types.SqlValue>): types.QueryBuilder {\n                    this._isInsert = true;\n                    this._from = table;\n                    this._insertData = data;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.update = function(table: string, data: Record<string, types.SqlValue>): types.QueryBuilder {\n                    this._isUpdate = true;\n                    this._from = table;\n                    this._updateData = data;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.delete = function(table: string): types.QueryBuilder {\n                    this._isDelete = true;\n                    this._from = table;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.raw = function(sql: string, params: types.SqlValue[] = []): types.QueryBuilder {\n                    self.currentQuery = sql;\n                    self.currentParams = params;\n                    return this as unknown as types.QueryBuilder;\n                };\n\n                builder.execute = function(): unknown[] {\n                    let sql = '';\n\n                    if (this._isInsert && this._insertData) {\n                        const columns = Object.keys(this._insertData);\n                        const placeholders = columns.map(() => '?').join(', ');\n                        sql = `INSERT INTO ${this._from} (${columns.join(', ')}) VALUES (${placeholders})`;\n                        self.currentParams = Object.values(this._insertData);\n                    } else if (this._isUpdate && this._updateData) {\n                        const setClauses = Object.keys(this._updateData).map(col => `${col} = ?`);\n                        const updateValues = Object.values(this._updateData);\n                        self.currentParams = [...updateValues, ...self.currentParams] as types.SqlValue[];\n                        sql = `UPDATE ${this._from} SET ${setClauses.join(', ')}`;\n\n                        if (this._where.length > 0) {\n                            sql += ` WHERE ${this._where.join(' AND ')}`;\n                        }\n                    } else if (this._isDelete) {\n                        sql = `DELETE FROM ${this._from}`;\n\n                        if (this._where.length > 0) {\n                            sql += ` WHERE ${this._where.join(' AND ')}`;\n                        }\n                    } else {\n                        // SELECT query\n                        sql = `SELECT ${this._select.join(', ')} FROM ${this._from}`;\n\n                        if (this._where.length > 0) {\n                            sql += ` WHERE ${this._where.join(' AND ')}`;\n                        }\n\n                        if (this._orderBy) {\n                            sql += ` ${this._orderBy}`;\n                        }\n\n                        if (this._limit !== null) {\n                            sql += ` LIMIT ${this._limit}`;\n                        }\n\n                        if (this._offset !== null) {\n                            sql += ` OFFSET ${this._offset}`;\n                        }\n                    }\n\n                    if (!sql && self.currentQuery) {\n                        sql = self.currentQuery;\n                    }\n\n                    const stmt = self.db.query(sql);\n                    const result = stmt.all(...self.currentParams) as unknown[];\n                    self.reset();\n                    return result;\n                };\n\n                builder.executeOne = function(): unknown | null {\n                    const results = this.execute!();\n                    return results.length > 0 ? results[0] : null;\n                };\n\n                builder.executeRaw = function(sql: string, params: types.SqlValue[] = []): unknown[] {\n                    const stmt = self.db.query(sql);\n                    const result = stmt.all(...params) as unknown[];\n                    return result;\n                };\n\n                return builder as types.QueryBuilder;\n            }\n\n            private generateCreateTableSQL(schema: types.TableSchema): string {\n                const columnDefs = schema.columns.map(col => {\n                    let def = `${col.name} ${col.type}`;\n\n                    if (col.primaryKey) {\n                        def += ' PRIMARY KEY';\n                        if (col.autoIncrement) {\n                            def += ' AUTOINCREMENT';\n                        }\n                    }\n\n                    if (col.notNull && !col.primaryKey) {\n                        def += ' NOT NULL';\n                    }\n\n                    if (col.unique) {\n                        def += ' UNIQUE';\n                    }\n\n                    if (col.default !== undefined) {\n                        if (typeof col.default === 'string') {\n                            def += ` DEFAULT '${col.default}'`;\n                        } else if (col.default === null) {\n                            def += ' DEFAULT NULL';\n                        } else {\n                            def += ` DEFAULT ${col.default}`;\n                        }\n                    }\n\n                    if (col.references) {\n                        def += ` REFERENCES ${col.references.table}(${col.references.column})`;\n                    }\n\n                    return def;\n                });\n\n                return `CREATE TABLE IF NOT EXISTS ${schema.name} (${columnDefs.join(', ')})`;\n            }\n\n        // └────────────────────────────────────────────────────────────────────┘\n\n    }\n\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\n\n\n\n// ╔════════════════════════════════════════ HELP ════════════════════════════════════════╗\n\n    // ════════ Schema Builder Helpers ════════\n    export function table(name: string, columns: types.ColumnDefinition[]): types.TableSchema {\n        return { name, columns };\n    }\n\n    export function column(name: string, type: types.ColumnType): types.ColumnDefinition {\n        return { name, type };\n    }\n\n    export function integer(name: string): types.ColumnDefinition {\n        return { name, type: 'INTEGER' };\n    }\n\n    export function text(name: string): types.ColumnDefinition {\n        return { name, type: 'TEXT' };\n    }\n\n    export function real(name: string): types.ColumnDefinition {\n        return { name, type: 'REAL' };\n    }\n\n    export function blob(name: string): types.ColumnDefinition {\n        return { name, type: 'BLOB' };\n    }\n\n    export function numeric(name: string): types.ColumnDefinition {\n        return { name, type: 'NUMERIC' };\n    }\n\n    // ════════ Column Modifiers ════════\n    export function primaryKey(col: types.ColumnDefinition, autoIncrement = false): types.ColumnDefinition {\n        return { ...col, primaryKey: true, autoIncrement };\n    }\n\n    export function notNull(col: types.ColumnDefinition): types.ColumnDefinition {\n        return { ...col, notNull: true };\n    }\n\n    export function unique(col: types.ColumnDefinition): types.ColumnDefinition {\n        return { ...col, unique: true };\n    }\n\n    export function defaultValue(col: types.ColumnDefinition, value: types.SqlValue): types.ColumnDefinition {\n        return { ...col, default: value };\n    }\n\n    export function references(col: types.ColumnDefinition, table: string, column: string): types.ColumnDefinition {\n        return { ...col, references: { table, column } };\n    }\n\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝"]}