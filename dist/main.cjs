'use strict';var bun_sqlite=require('bun:sqlite');var o=class{constructor(t=":memory:"){this.currentQuery="";this.currentParams=[];this.schemas=new Map,this.db=new bun_sqlite.Database(t),this.db.exec("PRAGMA foreign_keys = ON");}close(){this.db.close();}defineSchema(t){this.schemas.set(t.name,t);let r=this.generateCreateTableSQL(t);if(this.db.exec(r),t.indexes)for(let e of t.indexes){let u=`CREATE ${e.unique?"UNIQUE":""} INDEX IF NOT EXISTS ${e.name} ON ${t.name} (${e.columns.join(", ")})`;this.db.exec(u);}}getSchema(t){return this.schemas.get(t)}listTables(){return this.db.query("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'").all().map(r=>r.name)}dropTable(t){this.db.exec(`DROP TABLE IF EXISTS ${t}`),this.schemas.delete(t);}query(){return this.reset(),this.createQueryBuilder()}find(t,r){let e=Object.entries(r).map(([n,u])=>({column:n,operator:"=",value:u}));return this.query().select().from(t).where(e).execute()}findOne(t,r){return this.query().select().from(t).where(Object.entries(r).map(([e,n])=>({column:e,operator:"=",value:n}))).limit(1).executeOne()}findById(t,r){return this.findOne(t,{id:r})}all(t){return this.query().select().from(t).execute()}insert(t,r){this.query().insert(t,r).execute();let e=this.db.query("SELECT last_insert_rowid() as id").get();return this.findById(t,e.id)}update(t,r,e){return this.query().update(t,e).where({column:"id",operator:"=",value:r}).execute(),this.findById(t,r)}delete(t,r){return this.query().delete(t).where({column:"id",operator:"=",value:r}).execute(),true}transaction(t){this.db.exec("BEGIN TRANSACTION");try{t(this),this.db.exec("COMMIT");}catch(r){throw this.db.exec("ROLLBACK"),r}}exec(t){this.db.exec(t);}raw(t,r=[]){return this.db.query(t).all(...r)}rawOne(t,r=[]){return this.db.query(t).get(...r)}reset(){this.currentQuery="",this.currentParams=[];}createQueryBuilder(){let t={_select:["*"],_from:"",_where:[],_orderBy:"",_limit:null,_offset:null,_isInsert:false,_isUpdate:false,_isDelete:false,_insertData:null,_updateData:null},r=this;return t.select=function(e){return this._select=e||["*"],this},t.from=function(e){return this._from=e,this},t.where=function(e){let u=(Array.isArray(e)?e:[e]).map(i=>{if(i.operator==="IS NULL"||i.operator==="IS NOT NULL")return `${i.column} ${i.operator}`;if(i.operator==="IN"&&Array.isArray(i.value)){let a=i.value.map(()=>"?").join(", ");return i.value.forEach(l=>{r.currentParams.push(l);}),`${i.column} IN (${a})`}else return r.currentParams.push(i.value),`${i.column} ${i.operator} ?`});return this._where.push(...u),this},t.and=function(e){return this.where(e)},t.or=function(e){if(e.operator==="IS NULL"||e.operator==="IS NOT NULL")this._where.push(`OR ${e.column} ${e.operator}`);else if(e.operator==="IN"&&Array.isArray(e.value)){let n=e.value.map(()=>"?").join(", ");e.value.forEach(u=>{r.currentParams.push(u);}),this._where.push(`OR ${e.column} IN (${n})`);}else r.currentParams.push(e.value),this._where.push(`OR ${e.column} ${e.operator} ?`);return this},t.orderBy=function(e,n="ASC"){return this._orderBy=`ORDER BY ${e} ${n}`,this},t.limit=function(e){return this._limit=e,this},t.offset=function(e){return this._offset=e,this},t.insert=function(e,n){return this._isInsert=true,this._from=e,this._insertData=n,this},t.update=function(e,n){return this._isUpdate=true,this._from=e,this._updateData=n,this},t.delete=function(e){return this._isDelete=true,this._from=e,this},t.raw=function(e,n=[]){return r.currentQuery=e,r.currentParams=n,this},t.execute=function(){let e="";if(this._isInsert&&this._insertData){let i=Object.keys(this._insertData),a=i.map(()=>"?").join(", ");e=`INSERT INTO ${this._from} (${i.join(", ")}) VALUES (${a})`,r.currentParams=Object.values(this._insertData);}else if(this._isUpdate&&this._updateData){let i=Object.keys(this._updateData).map(l=>`${l} = ?`),a=Object.values(this._updateData);r.currentParams=[...a,...r.currentParams],e=`UPDATE ${this._from} SET ${i.join(", ")}`,this._where.length>0&&(e+=` WHERE ${this._where.join(" AND ")}`);}else this._isDelete?(e=`DELETE FROM ${this._from}`,this._where.length>0&&(e+=` WHERE ${this._where.join(" AND ")}`)):(e=`SELECT ${this._select.join(", ")} FROM ${this._from}`,this._where.length>0&&(e+=` WHERE ${this._where.join(" AND ")}`),this._orderBy&&(e+=` ${this._orderBy}`),this._limit!==null&&(e+=` LIMIT ${this._limit}`),this._offset!==null&&(e+=` OFFSET ${this._offset}`));!e&&r.currentQuery&&(e=r.currentQuery);let u=r.db.query(e).all(...r.currentParams);return r.reset(),u},t.executeOne=function(){let e=this.execute();return e.length>0?e[0]:null},t.executeRaw=function(e,n=[]){return r.db.query(e).all(...n)},t}generateCreateTableSQL(t){let r=t.columns.map(e=>{let n=`${e.name} ${e.type}`;return e.primaryKey&&(n+=" PRIMARY KEY",e.autoIncrement&&(n+=" AUTOINCREMENT")),e.notNull&&!e.primaryKey&&(n+=" NOT NULL"),e.unique&&(n+=" UNIQUE"),e.default!==void 0&&(typeof e.default=="string"?n+=` DEFAULT '${e.default}'`:e.default===null?n+=" DEFAULT NULL":n+=` DEFAULT ${e.default}`),e.references&&(n+=` REFERENCES ${e.references.table}(${e.references.column})`),n});return `CREATE TABLE IF NOT EXISTS ${t.name} (${r.join(", ")})`}};function h(s,t){return {name:s,columns:t}}function f(s,t){return {name:s,type:t}}function c(s){return {name:s,type:"INTEGER"}}function m(s){return {name:s,type:"TEXT"}}function d(s){return {name:s,type:"REAL"}}function _(s){return {name:s,type:"BLOB"}}function g(s){return {name:s,type:"NUMERIC"}}function w(s,t=false){return {...s,primaryKey:true,autoIncrement:t}}function E(s){return {...s,notNull:true}}function S(s){return {...s,unique:true}}function D(s,t){return {...s,default:t}}function b(s,t,r){return {...s,references:{table:t,column:r}}}exports.DB=o;exports.blob=_;exports.column=f;exports.defaultValue=D;exports.integer=c;exports.notNull=E;exports.numeric=g;exports.primaryKey=w;exports.real=d;exports.references=b;exports.table=h;exports.text=m;exports.unique=S;//# sourceMappingURL=main.cjs.map
//# sourceMappingURL=main.cjs.map